Select cust, avg(ny.quant) as avg_ny_quant, avg(nj.quant) as avg_nj_quant, avg(ct.quant) as avg_ct_quant, avg(pa.quant) as avg_pa_quant
From sales
Group by just; nj, ny, ct, pa
Such that nj.state = “NJ”, ny.state = “NY”, ct.state = “CT”, pa.state = “PA”

--------------------

with ny as 
(select cust, avg(quant) as avg_ny_quant
from sales
where sales.state = 'NY'
group by cust, state
),

nj as
(select cust, avg(quant) as avg_nj_quant
from sales
where sales.state = 'NJ'
group by cust, state
),

ct as
(select cust, avg(quant) as avg_ct_quant
from sales
where sales.state = 'CT'
group by cust, state
),

pa as
(select cust, avg(quant) as avg_pa_quant
from sales
where sales.state = 'PA'
group by cust, state
),

custs as
(select distinct cust
from sales)

select pa.cust, avg_ny_quant, avg_nj_quant, avg_ct_quant, avg_pa_quant
from custs
	left outer join ny on custs.cust = ny.cust
	left outer join nj on custs.cust = nj.cust
	left outer join ct on custs.cust = ct.cust
	left outer join pa on custs.cust = pa.cust
