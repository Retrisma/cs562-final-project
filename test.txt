SELECT ATTRIBUTE (S):
cust, prod, 1_count_cust, 2_count_cust
NUMBER OF GROUPING VARIABLES (n):
2
GROUPING ATTRIBUTES (V):
cust, prod
F-VECT ([F]):
avg_quant, 1_count_cust, 2_count_cust
SELECT CONDITION-VECT ([Ïƒ]):
1.year < 2017 and 1.quant > avg_quant, 2.year < 2018 and 2.quant > avg_quant
HAVING CONDITION (G):


-------------------------
with ny as 
(select cust, avg(quant) as avg_ny_quant
from sales
where sales.state = 'NY'
group by cust, state
),

nj as
(select cust, avg(quant) as avg_nj_quant
from sales
where sales.state = 'NJ'
group by cust, state
),

ct as
(select cust, avg(quant) as avg_ct_quant
from sales
where sales.state = 'CT'
group by cust, state
),

pa as
(select cust, avg(quant) as avg_pa_quant
from sales
where sales.state = 'PA'
group by cust, state
),

custs as
(select distinct cust
from sales)

select pa.cust, avg_ny_quant, avg_nj_quant, avg_ct_quant, avg_pa_quant
from custs
    left outer join ny on custs.cust = ny.cust
    left outer join nj on custs.cust = nj.cust
    left outer join ct on custs.cust = ct.cust
    left outer join pa on custs.cust = pa.cust